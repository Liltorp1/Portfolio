<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Passive Income AI</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    #chat { width: 100%; max-width: 700px; margin: auto; }
    .msg { padding: 10px; margin: 10px 0; border-radius: 8px; }
    .user { background: #d1e7ff; text-align: right; }
    .ai { background: #fff; border: 1px solid #ccc; }
    #inputArea { display: flex; gap: 10px; margin-top: 20px; }
    #inputArea input { flex: 1; padding: 10px; }
    #inputArea button { padding: 10px 20px; }
    #settings { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; }
  </style>
</head>
<body>

<div id="settings">
  <h3>Settings</h3>
  <label>Claude API Key:</label>
  <input type="password" id="apiKeyInput" placeholder="Enter API key" style="width: 60%;" />
  <button onclick="saveKey()">Save</button>
  <button onclick="clearKey()">Clear</button>
  <p id="keyStatus"></p>
</div>

<div id="chat"></div>

<div id="inputArea">
  <input id="userInput" placeholder="Type your message..." />
  <button onclick="sendMessage()">Send</button>
</div>

<script>
const WORKER_URL = "YOUR_WORKER_URL_HERE"; // <--- Replace after deploying Worker

document.addEventListener("DOMContentLoaded", () => {
  const savedKey = localStorage.getItem("anthropic_api_key");
  document.getElementById("keyStatus").innerText = savedKey ? "API key loaded" : "No API key saved";
});

function saveKey() {
  const key = document.getElementById("apiKeyInput").value.trim();
  if (!key) return alert("Enter a key first");
  localStorage.setItem("anthropic_api_key", key);
  document.getElementById("keyStatus").innerText = "API key saved";
}

function clearKey() {
  localStorage.removeItem("anthropic_api_key");
  document.getElementById("keyStatus").innerText = "API key cleared";
}

function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.innerText = text;
  document.getElementById("chat").appendChild(div);
  window.scrollTo(0, document.body.scrollHeight);
}

async function sendMessage() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  const apiKey = localStorage.getItem("anthropic_api_key");
  if (!apiKey) return alert("Please save your API key first");

  addMessage(text, "user");
  input.value = "";

  const payload = {
    model: "claude-3-5-sonnet-latest",
    max_tokens: 1024,
    messages: [{ role: "user", content: text }]
  };

  try {
    const response = await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json", "x-api-key": apiKey },
      body: JSON.stringify(payload)
    });

    const data = await response.json();
    const reply = data?.content?.[0]?.text || "No response";
    addMessage(reply, "ai");

  } catch (err) {
    addMessage("Error: " + err.message, "ai");
  }
}
</script>

</body>
</html>
